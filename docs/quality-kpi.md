# 品質KPI設計と評価サンプル

本ドキュメントは議事録生成の品質を継続的に測定するためのKPI設計と、
評価時に使うサンプルの仕様をまとめたものです。空セクション率・時刻欠落率を
中心に、運用で必要な補助指標も定義します。

## 前提となるデータ構造

議事録は以下の3つの構造を前提に評価します。

1. **Sections**: テンプレートで定義されたセクション（例: サマリー、決定事項、TODO）。
2. **Timeline items**: 発話や議題ごとのタイムライン要素（例: 00:01:30 発話）。
3. **Metadata**: 会議種別、参加者、対象日付など。

評価は「生成結果」と「テンプレート定義（期待されるセクション一覧）」の両方を参照します。

## KPI定義

### 1. 空セクション率（Empty Section Rate）

**目的**: 期待セクションが空のまま残っていないかを測定する。

**対象**: テンプレートで必須と指定されたセクション。

**算出方法**:

```
空セクション率 = 空セクション数 / 必須セクション総数
```

**空セクションの判定**
- セクション本文が空文字列、または空白・改行のみ。
- 「未記入」「TBD」などのプレースホルダーのみ。

**補助メモ**
- セクションが未生成（キーが存在しない）場合は「空」として扱う。

### 2. 時刻欠落率（Missing Timestamp Rate）

**目的**: タイムラインや発話に時刻が付与されているかを測定する。

**対象**: タイムライン要素（発話・議題・イベント）。

**算出方法**:

```
時刻欠落率 = 時刻が欠落したタイムライン要素数 / タイムライン要素総数
```

**時刻欠落の判定**
- `timestamp` フィールドが欠落している。
- `timestamp` が空文字列または無効（例: `"??:??"`）。

**補助メモ**
- 形式は `HH:MM:SS` または `MM:SS` を許容する。

### 3. セクション充足率（Section Coverage Rate）

**目的**: 必須セクションのうち、情報が十分に書かれている割合を測る。

**算出方法**:

```
セクション充足率 = 内容ありセクション数 / 必須セクション総数
```

**内容ありの判定**
- 30文字以上、または箇条書きが2項目以上。

### 4. アクションアイテム抽出率（Action Item Coverage）

**目的**: TODOや宿題が抽出されているかを測る。

**算出方法**:

```
アクション抽出率 = TODOセクション内の有効アイテム数 / 期待アイテム数
```

**補助メモ**
- 期待アイテム数は評価者が手動で付与する。

## 評価サンプル仕様

評価用サンプルは JSONL で管理し、1行1サンプルとします。

```json
{
  "id": "sample-001",
  "template": {
    "requiredSections": ["summary", "decisions", "todos"]
  },
  "minutes": {
    "sections": {
      "summary": "...",
      "decisions": "...",
      "todos": "..."
    },
    "timeline": [
      { "timestamp": "00:01:10", "text": "..." }
    ]
  },
  "expected": {
    "emptySectionRate": 0.0,
    "missingTimestampRate": 0.0
  }
}
```

### サンプル設計ポリシー
- **空セクション率**と**時刻欠落率**が0/0.5/1.0を取るケースを必ず含める。
- 「セクション欠落」「プレースホルダーのみ」「時刻が不正」などの境界条件を含める。
- 1サンプルは最低でも2セクション・2タイムライン要素を含む。

## 評価フロー案

1. サンプルJSONLを読み込み。
2. KPIロジックを適用し、算出値と `expected` を比較。
3. 想定値との差分を集計し、改善対象を特定。

## 今後の拡張候補

- 話者識別率（Speaker Tag Accuracy）
- 決定事項整合率（Decision Consistency）
- 重要発話抽出率（Highlight Coverage）
